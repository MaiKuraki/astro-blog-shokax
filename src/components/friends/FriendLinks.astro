---
export interface FriendLink {
  url: string;
  title: string;
  desc: string;
  author: string;
  avatar: string;
  color?: string;
  siteImage?: string;
}

interface Props {
  links: FriendLink[];
}

const { links } = Astro.props;
---

<div class="friend-links">
  {
    links.map((link) => (
      <article
        class="friend-card"
        style={`--friend-accent: ${link.color || "var(--color-blue)"};`}
      >
        {link.siteImage && (
          <a
            class="site-preview"
            href={link.url}
            target="_blank"
            rel="noreferrer"
          >
            <img
              src={link.siteImage}
              alt={`${link.title} 站点预览`}
              loading="lazy"
              decoding="async"
            />
            <span class="site-preview-mask">访问站点</span>
          </a>
        )}
        <div class="friend-body">
          <a
            class="friend-avatar"
            href={link.url}
            target="_blank"
            rel="noreferrer"
            aria-label={`访问 ${link.author} 站点`}
          >
            <img
              src={link.avatar}
              alt={`${link.author} 头像`}
              loading="lazy"
              decoding="async"
            />
          </a>
          <div class="friend-content">
            <div class="friend-title-row">
              <a
                class="friend-title"
                href={link.url}
                target="_blank"
                rel="noreferrer"
              >
                {link.title}
              </a>
              <span class="friend-author">by {link.author}</span>
            </div>
            <p class="friend-desc">{link.desc}</p>
          </div>
        </div>
      </article>
    ))
  }
</div>

<style>
  .friend-links {
    display: grid;
    gap: 1.25rem;
    grid-template-columns: repeat(2, minmax(16.5rem, 1fr));
  }

  .friend-card {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1.15rem 1.35rem;
    border-radius: 1rem;
    background: linear-gradient(135deg, var(--grey-0), var(--grey-1));
    border: 1px solid var(--grey-3);
    box-shadow: 0 0.75rem 1.5rem var(--box-bg-shadow);
    overflow: hidden;
    will-change: transform, box-shadow;
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .friend-card::after {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle at top right,
      var(--grey-2) 0%,
      transparent 60%
    );
    opacity: 0.6;
    pointer-events: none;
  }

  .friend-card:hover {
    transform: translateY(-0.3rem);
    box-shadow: 0 1rem 1.8rem var(--box-bg-shadow);
  }

  .friend-body {
    position: relative;
    z-index: 1;
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .friend-avatar {
    position: relative;
    z-index: 1;
    flex: 0 0 auto;
  }

  .friend-avatar img {
    width: 4.5rem;
    height: 4.5rem;
    border-radius: 0.9rem;
    object-fit: cover;
    background: var(--grey-2);
    border: 1px solid var(--grey-3);
    box-shadow: 0 0.4rem 0.8rem var(--grey-9-a1);
    will-change: box-shadow;
    transition: box-shadow 0.3s ease;
  }

  .friend-content {
    position: relative;
    z-index: 1;
    flex: 1;
  }

  .friend-title-row {
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .friend-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--grey-7);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .friend-author {
    font-size: 0.85rem;
    color: var(--grey-6);
  }

  .friend-desc {
    margin: 0.45rem 0 0;
    color: var(--grey-6);
    font-size: 0.95rem;
    line-height: 1.7;
    transition: color 0.3s ease;
  }

  .friend-card:hover .friend-title,
  .friend-card:hover .friend-desc,
  .friend-card:focus-within .friend-title,
  .friend-card:focus-within .friend-desc {
    color: var(--friend-accent);
  }

  .friend-card:hover .friend-avatar img,
  .friend-card:focus-within .friend-avatar img {
    box-shadow:
      0 0.45rem 0.9rem var(--grey-9-a1),
      0 0 0.75rem color-mix(in srgb, var(--friend-accent) 70%, transparent);
  }

  .site-preview {
    position: relative;
    width: 100%;
    height: 9rem;
    max-height: 0;
    margin-bottom: 0;
    border-radius: 0.85rem;
    overflow: hidden;
    border: 1px solid var(--grey-3);
    background: var(--grey-1);
    box-shadow: 0 0.6rem 1.2rem var(--box-bg-shadow);
    transform: translateY(-0.75rem);
    opacity: 0;
    pointer-events: none;
    will-change: transform, opacity;
    transition:
      max-height 0.4s ease,
      margin 0.4s ease,
      transform 0.4s ease,
      opacity 0.4s ease;
  }

  .site-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .site-preview-mask {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    color: var(--grey-0);
    background: linear-gradient(
      120deg,
      rgba(0, 0, 0, 0.2),
      rgba(0, 0, 0, 0.55)
    );
    opacity: 0;
    will-change: opacity;
    transition: opacity 0.3s ease;
  }

  .site-preview:hover .site-preview-mask,
  .site-preview:focus-visible .site-preview-mask {
    opacity: 1;
  }

  .friend-card:hover .site-preview,
  .friend-card:focus-within .site-preview {
    max-height: 9rem;
    margin-bottom: 0.75rem;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  @media (max-width: 720px) {
    .friend-card {
      padding: 1rem;
    }

    .friend-body {
      align-items: flex-start;
    }

    .friend-avatar img {
      width: 4rem;
      height: 4rem;
      border-radius: 0.75rem;
    }

    .friend-content {
      padding-right: 0;
    }

    .site-preview {
      height: 11rem;
      max-height: 11rem;
      margin-bottom: 0.75rem;
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }
  }

  @media (max-width: 480px) {
    .friend-links {
      grid-template-columns: 1fr;
    }
  }
</style>
